/*******************************************************************************
 *
 *  Copyright (c)  2011 Toura, LLC.	All Rights Reserved.
 *  http://toura.com
 *
 *  LICENSE: https://github.com/Toura/mulberry/blob/master/LICENSE.txt
 *
 *******************************************************************************/
dojo.provide("client.base");if(!dojo._hasResource["client.routes"]){dojo._hasResource["client.routes"]=true;dojo.provide("client.routes");mulberry.page("/todos",{name:"Todos",pageDef:"todos"},true);mulberry.page("/completed",{name:"Completed",pageDef:"completed"});mulberry.pageDef("todos",{capabilities:["PageTodos"],screens:[{name:"index",regions:[{className:"todo-form-container",components:["TodoForm"]},{className:"todo-list-container",scrollable:true,components:["TodoList"]},{className:"todo-tools-container",components:["TodoTools"]}]}]});mulberry.pageDef("completed",{capabilities:["PageCompleted"],screens:[{name:"index",regions:[{className:"nav-bar-container",components:["NavBar"]},{className:"todo-list-container",scrollable:true,components:["TodoList"]}]}]});}if(!dojo._hasResource["client.capabilities.PageTodos"]){dojo._hasResource["client.capabilities.PageTodos"]=true;dojo.provide("client.capabilities.PageTodos");console.log("mulberry",mulberry);mulberry.capability("PageTodos",{requirements:{todoList:"TodoList",todoForm:"TodoForm",todoTools:"TodoTools"},connects:[["todoForm","onAdd","_add"],["todoList","onComplete","_complete"],["todoList","onDelete","_delete"],["todoTools","onCompleteAll","_completeAll"]],init:function(){this.todos=client.stores.todos;this._updateList();},_delete:function(id){this.todos.remove(id);this._updateList();},_add:function(_1){this.todos.add(_1);this._updateList();},_complete:function(id){this.todos.finish(id);this._updateList();},_updateList:function(){var _2=this.todos.query(function(_3){return !_3.complete;});this.todoList.set("todos",_2);},_completeAll:function(){this.todos.query(function(_4){return !_4.complete;}).forEach(dojo.hitch(this,function(t){t.finish();this.todos.put(t);}));this._updateList();}});}if(!dojo._hasResource["client.capabilities.PageCompleted"]){dojo._hasResource["client.capabilities.PageCompleted"]=true;dojo.provide("client.capabilities.PageCompleted");mulberry.capability("PageCompleted",{requirements:{todoList:"TodoList"},connects:[["todoList","onUncomplete","_uncomplete"],["todoList","onDelete","_delete"]],init:function(){this.todos=client.stores.todos;this._updateList();},_delete:function(id){this.todos.remove(id);this._updateList();},_uncomplete:function(id){this.todos.unfinish(id);this._updateList();},_updateList:function(){this.todoList.set("todos",this.todos.query({complete:true}));}});}if(!dojo._hasResource["client.components.TodoForm"]){dojo._hasResource["client.components.TodoForm"]=true;dojo.provide("client.components.TodoForm");mulberry.component("TodoForm",{componentTemplate:dojo.cache("client.components","TodoForm/TodoForm.haml","%form.component.todo-form\n  %input{ type : 'text', placeholder : 'New todo', dojoAttachPoint : 'descriptionInput' }\n  %button{ dojoAttachPoint : 'saveButton' } Add\n"),init:function(){this.connect(this.domNode,"submit",function(e){e.preventDefault();var _5=dojo.trim(this.descriptionInput.value),_6;if(!_5){return;}_6={description:_5};this.domNode.reset();this.onAdd(_6);});},onAdd:function(_7){}});}if(!dojo._hasResource["client.components.TodoList"]){dojo._hasResource["client.components.TodoList"]=true;dojo.provide("client.components.TodoList");mulberry.component("TodoList",{componentTemplate:dojo.cache("client.components","TodoList/TodoList.haml","%ul.component.todo-list\n"),itemTemplate:mulberry.haml(dojo.cache("client.components","TodoList/Item.haml","%li{ data-id : id }\n  :if checked\n    %input{ type : 'checkbox', checked : 'checked' }\n  :if !checked\n    %input{ type : 'checkbox' }\n  %span= description\n  .delete Delete\n")),init:function(){this.connect(this.domNode,"click","_handleClick");},_handleClick:function(e){var t=e.target,_8,id,_9;if(t.nodeName.match(/INPUT|SPAN|DIV/)){if(dojo.hasClass(t,"delete")){_9=true;}t=t.parentNode;}if(t.nodeName==="LI"){id=dojo.attr(t,"data-id");if(_9){this.onDelete(id);return;}_8=t.querySelector("input");if(_8.checked){_8.checked=false;this.onComplete(id);}else{_8.checked=true;this.onUncomplete(id);}}},_setTodosAttr:function(_a){if(!_a.length){this.domNode.innerHTML="<li class=\"no-items\">No items yet</li>";return;}_a=dojo.map(_a,function(t){t.checked=!!t.complete;return t;});this.populate(this.itemTemplate,_a);},onComplete:function(id){},onUncomplete:function(id){},onDelete:function(id){}});}if(!dojo._hasResource["client.components.TodoTools"]){dojo._hasResource["client.components.TodoTools"]=true;dojo.provide("client.components.TodoTools");mulberry.component("TodoTools",{componentTemplate:dojo.cache("client.components","TodoTools/TodoTools.haml",".component.todo-manager\n  %button{ dojoAttachPoint : 'completeAll' } Complete All\n  %a{ href : '#/completed' } View Completed\n"),init:function(){this.connect(this.completeAll,"click","onCompleteAll");},onCompleteAll:function(){}});}if(!dojo._hasResource["client.stores.todos"]){dojo._hasResource["client.stores.todos"]=true;dojo.provide("client.stores.todos");mulberry.store("todos",{model:"Todo",finish:function(id){this.invoke(id,"finish");},unfinish:function(id){this.invoke(id,"unfinish");}});}if(!dojo._hasResource["client.models.Todo"]){dojo._hasResource["client.models.Todo"]=true;dojo.provide("client.models.Todo");mulberry.model("Todo",{complete:false,finish:function(){this.set("complete",true);},unfinish:function(){this.set("complete",false);}});}if(!dojo._hasResource["client.components.NavBar"]){dojo._hasResource["client.components.NavBar"]=true;dojo.provide("client.components.NavBar");mulberry.component("NavBar",{componentTemplate:dojo.cache("client.components","NavBar/NavBar.haml",".component.nav-bar\n  %div\n    %a.back\n  %h1 Completed\n\n\n"),init:function(){this.connect(this.query("a.back")[0],"click",$m.app.Router.back);}});}dojo.subscribe("/app/deviceready",function(){mulberry.app.Config.set("app",{name:"MyApp"});mulberry.registerComponentNamespace(client.components);setTimeout(function(){dojo.publish("/app/ready");},10);});
